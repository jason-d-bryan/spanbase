<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpanBase - WV Bridge Management</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Permanent+Marker&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Aptos', 'Roboto', 'Segoe UI', sans-serif;
            font-size: 12pt;
            font-weight: 500;
            background: #0a0e17;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        /* WVDOH Colors */
        :root {
            --wvdoh-blue: #003B5C;
            --wvdoh-yellow: #FFB81C;
            --wvdoh-light-blue: #0067A0;
            --box-bg: rgba(0, 59, 92, 0.70);
            --box-border: rgba(255, 184, 28, 0.4);
        }
        
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* Last Updated Banner */
        .last-updated {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: var(--box-bg);
            padding: 8px 20px; border-radius: 6px;
            border: 1px solid var(--wvdoh-yellow);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            font-size: 11pt; text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .header {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: var(--box-bg); padding: 20px 30px;
            border-radius: 8px; border: 1px solid var(--wvdoh-yellow);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }
        
        .header-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(135deg, rgba(0, 59, 92, 0.85), rgba(0, 103, 160, 0.85)),
                url('bridge-header-bg.jpg');
            background-position: center, center center;
            background-size: auto, cover;
            background-repeat: no-repeat, no-repeat;
            border-radius: 8px; 
            z-index: -1;
        }
        
        .header-overlay::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('bridge-header-bg.jpg');
            background-position: center center;
            background-size: cover;
            background-repeat: no-repeat;
            opacity: 0.2;
            border-radius: 8px;
            z-index: -1;
        }
        
        .header h1 { 
            font-family: 'Highway Gothic', 'Arial Narrow', sans-serif;
            font-size: 36pt; 
            margin-bottom: 8px;
            color: var(--wvdoh-yellow);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
            letter-spacing: 2px;
        }
        
        .header .subtitle {
            font-size: 11pt;
            color: #fff;
            margin-bottom: 3px;
            text-align: center;
        }

        .header .email {
            font-size: 10pt;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .header .email a {
            color: var(--wvdoh-yellow);
            text-decoration: none;
        }
        
        .header .email a:hover {
            text-decoration: underline;
        }
        
        .search {}
        .search input {
            padding: 10px 14px; width: 100%;
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid var(--box-border);
            border-radius: 6px; color: #fff; font-size: 11pt;
            font-family: 'Aptos', sans-serif;
            backdrop-filter: blur(5px);
        }
        .search input:focus { 
            outline: none; 
            border-color: var(--wvdoh-yellow);
            background: rgba(255, 255, 255, 0.15);
        }
        .search input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Evaluation Panel with Folder Tab */
        .evaluation-panel {
            position: fixed; left: -320px; top: 0; bottom: 0;
            z-index: 10000;
            background: #376a81;
            border: 1px solid var(--wvdoh-yellow); border-left: none;
            border-radius: 0 12px 12px 0; width: 320px;
            box-shadow: 4px 0 16px rgba(0, 0, 0, 0.4);
            display: flex; flex-direction: column;
            transition: left 0.3s ease;
        }
        .evaluation-panel.open { left: 0; }
        .evaluation-panel.behind { z-index: 9998; } /* Behind when Attributes active */
        .evaluation-panel .folder-tab { top: calc(50% - 165px); }
        
        /* Attributes Filter Panel - Red tab, stacks on top when active */
        .attributes-panel {
            position: fixed; left: -320px; top: 0; bottom: 0;
            z-index: 9999;
            background: #376a81;
            border: 1px solid var(--wvdoh-yellow); border-left: none;
            border-radius: 0 12px 12px 0; width: 320px;
            box-shadow: 4px 0 16px rgba(0, 0, 0, 0.4);
            display: flex; flex-direction: column;
            transition: left 0.3s ease;
        }
        .attributes-panel.open { left: 0; }
        .attributes-panel.ontop { z-index: 10001; } /* On top when active */

        /* Red tab - 5px below blue tab (165px = 160px tab height + 5px gap) */
        .attributes-panel .folder-tab {
            background: #8B0000;
            top: 50%;
        }
        .attributes-panel .folder-tab:hover {
            background: #A52A2A;
        }

        /* HUB Filter Panel - Green tab, third panel */
        .hub-panel {
            position: fixed; left: -320px; top: 0; bottom: 0;
            z-index: 9997;
            background: #376a81;
            border: 1px solid var(--wvdoh-yellow); border-left: none;
            border-radius: 0 12px 12px 0; width: 320px;
            box-shadow: 4px 0 16px rgba(0, 0, 0, 0.4);
            display: flex; flex-direction: column;
            transition: left 0.3s ease;
        }
        .hub-panel.open { left: 0; }
        .hub-panel.ontop { z-index: 10002; }
        .hub-panel .folder-tab {
            background: #2E7D32;
            top: calc(50% + 165px);
        }
        .hub-panel .folder-tab:hover {
            background: #388E3C;
        }
        
        /* NHS Filter Buttons */
        .nhs-btn {
            flex: 1;
            padding: 8px 12px;
            background: #5a99b8; /* Lighter blue for contrast */
            border: 1px solid var(--wvdoh-yellow);
            color: #fff;
            font-size: 10pt;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .nhs-btn:first-child { border-radius: 6px 0 0 6px; }
        .nhs-btn:last-child { border-radius: 0 6px 6px 0; }
        .nhs-btn.active {
            background: var(--wvdoh-yellow); /* Yellow active button */
            color: var(--wvdoh-blue);
        }
        .nhs-btn:hover:not(.active) {
            background: #6bb3d4; /* Brighter on hover */
        }
        
        /* Folder Tab */
        .folder-tab {
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 160px;
            background: var(--wvdoh-blue);
            border: 1px solid var(--box-border);
            border-left: none;
            border-radius: 0 12px 12px 0;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .folder-tab:hover {
            background: var(--wvdoh-light-blue);
            right: -42px;
        }
        .folder-tab-text {
            writing-mode: vertical-rl;
            transform: rotate(0deg);
            font-family: 'Aptos', 'Roboto', 'Segoe UI', sans-serif;
            font-size: 12pt;
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            user-select: none;
            line-height: 1;
            letter-spacing: 0;
        }
        
        .panel-header {
            display: none;
        }
        
        .panel-body {
            padding: 20px; overflow-y: auto; flex: 1;
        }
        
        .section-switcher {
            display: flex; background: rgba(0, 0, 0, 0.3);
            border-radius: 8px; padding: 4px; margin-bottom: 20px;
        }
        .section-btn {
            flex: 1; padding: 12px 16px; border: none;
            background: transparent; color: rgba(255, 255, 255, 0.6);
            font-size: 11pt; font-weight: 600;
            cursor: pointer; border-radius: 6px; transition: all 0.3s;
        }
        .section-btn.active { 
            color: #fff; 
            background: var(--wvdoh-blue);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); 
        }
        .section-content { display: none; }
        .section-content.active { display: block; }
        
        .panel-instructions {
            font-size: 10pt; color: rgba(255, 255, 255, 0.8); 
            margin-bottom: 20px; line-height: 1.5;
        }
        
        .section-title {
            font-size: 10pt;
            color: var(--wvdoh-yellow);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .inspection-types-section,
        .inspection-months-section,
        .inspection-options-section {
            margin-bottom: 20px;
            padding: 12px;
            background: rgba(0, 40, 85, 0.6);
            border-radius: 6px;
            border: 1px solid var(--wvdoh-yellow);
        }
        
        .checkbox-label {
            display: block;
            margin-bottom: 2px;
            font-size: 10pt;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            padding: 1px 0;
        }
        .checkbox-label input {
            margin-right: 8px;
            cursor: pointer;
            accent-color: var(--wvdoh-yellow);
        }
        .checkbox-label:hover {
            color: #fff;
        }
        
        .months-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .inspection-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .inspection-legend {
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }
        
        .legend-item-inline {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 9pt;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(0, 40, 85, 0.95);
            border-top: 1px solid var(--wvdoh-yellow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
            transition: background 0.3s ease;
        }
        /* Red status bar when Attributes Filter active */
        .status-bar.attributes-active {
            background: rgba(139, 0, 0, 0.95); /* Dark red */
        }
        .status-bar span {
            color: var(--wvdoh-yellow);
            font-size: 11pt;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .slider-group { margin-bottom: 20px; }
        .slider-group label {
            display: block; font-size: 11pt; color: #fff;
            margin-bottom: 8px; font-weight: 600;
        }
        .slider-container {
            display: flex; align-items: center; gap: 12px;
        }
        .eval-slider {
            flex: 1; height: 6px; border-radius: 3px;
            background: rgba(255, 255, 255, 0.2); outline: none;
            -webkit-appearance: none;
        }
        .eval-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 18px; height: 18px;
            background: var(--wvdoh-yellow); border-radius: 50%; 
            cursor: pointer; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        .slider-value {
            font-size: 12pt; font-weight: bold; color: var(--wvdoh-yellow);
            min-width: 25px; text-align: right;
        }
        
        .panel-actions {
            display: flex; gap: 10px; margin-top: 20px;
        }
        .btn-reset, .btn-apply {
            flex: 1; padding: 10px; border-radius: 6px;
            border: none; font-size: 11pt; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        .btn-reset {
            background: rgba(255, 255, 255, 0.15); color: #fff;
            border: 1px solid var(--box-border);
        }
        .btn-reset:hover { background: rgba(255, 255, 255, 0.25); }
        .btn-apply {
            background: var(--wvdoh-yellow); color: var(--wvdoh-blue);
        }
        .btn-apply:hover { background: #FFC940; }
        
        .legend {
            position: absolute; bottom: 40px; right: 20px; z-index: 1000;
            background: var(--box-bg); padding: 15px 20px;
            border-radius: 8px; border: 1px solid var(--wvdoh-yellow);
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }
        .legend h4 {
            font-size: 11pt; margin-bottom: 10px; text-transform: uppercase;
            letter-spacing: 1px; color: var(--wvdoh-yellow);
            text-align: center;
            background: var(--wvdoh-blue);
            margin: -15px -20px 10px -20px;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
        }
        .legend-item {
            display: flex; align-items: center; margin-bottom: 3px; font-size: 10pt;
            padding: 4px 6px; border-radius: 4px; cursor: pointer;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .legend-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--wvdoh-yellow);
        }
        .legend-item.inactive {
            opacity: 0.4;
        }
        .legend-color {
            width: 14px; height: 14px; border-radius: 50%;
            margin-right: 8px; border: 1px solid #fff;
        }
        
        /* Count Report Box */
        .count-report {
            position: absolute;
            top: 145px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            background: #376a81;
            border: 2px solid var(--box-border);
            border-radius: 8px;
            width: 240px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .debug-panel {
            display: none;
            position: fixed; bottom: 10px; left: 10px; z-index: 1200;
            background: rgba(0, 0, 0, 0.88); border: 1px solid rgba(255, 184, 28, 0.4);
            border-radius: 8px; padding: 10px 14px; width: 260px;
            font-family: 'Consolas', 'Monaco', monospace; font-size: 9pt;
            color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px);
            max-height: 80vh; overflow-y: auto;
        }
        .debug-panel h4 {
            font-size: 9pt; margin: 0 0 8px 0; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--wvdoh-yellow);
            text-align: center; border-bottom: 1px solid rgba(255, 184, 28, 0.3);
            padding-bottom: 6px;
        }
        .debug-section {
            margin-bottom: 8px; padding-bottom: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .debug-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .debug-section-label {
            font-size: 8pt; text-transform: uppercase; letter-spacing: 1px;
            color: rgba(255, 184, 28, 0.7); margin-bottom: 4px;
        }
        .debug-item {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 3px; font-size: 9pt; line-height: 1.4;
        }
        .debug-item span:first-child { color: rgba(255, 255, 255, 0.6); }
        .debug-item span:last-child { color: #fff; font-weight: bold; }
        .debug-swatches {
            display: flex; gap: 6px; align-items: flex-end; margin-top: 4px; flex-wrap: wrap;
        }
        .debug-swatch {
            display: flex; flex-direction: column; align-items: center; gap: 2px;
        }
        .debug-swatch-label { font-size: 7pt; color: rgba(255, 255, 255, 0.5); }
        .debug-pixel-block { background: var(--wvdoh-yellow); }
        .debug-opacity-block {
            width: 20px; height: 20px; background: #3b82f6; border: 1px solid rgba(255,255,255,0.2);
        }
        .debug-stroke-line { background: #fff; border-radius: 1px; }
        .debug-radius-circle {
            border-radius: 50%; background: rgba(59, 130, 246, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .debug-point-size {
            border-radius: 50%; background: rgba(255, 184, 28, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Name Tooltip */
        .name-tooltip {
            position: absolute; z-index: 9999; 
            background: var(--box-bg);
            color: #fff; padding: 8px 14px; border-radius: 6px;
            font-family: 'Aptos', sans-serif; font-size: 12pt;
            white-space: nowrap; pointer-events: none;
            transform: translateX(-50%);
            border: 1px solid var(--box-border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }
        
        /* Menu Title */
        .menu-title {
            position: absolute; z-index: 10001;
            transform: translateX(-50%);
            background: rgba(0, 59, 92, 1.0);
            padding: 10px 14px;
            border-radius: 6px;
            border: 1px solid var(--wvdoh-yellow);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6), 0 2px 8px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            pointer-events: auto;
            overflow: hidden;
        }
        .menu-title-bg {
            position: absolute !important;
            top: 0; left: 0; right: 0; bottom: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.7;
            border-radius: 6px;
            z-index: 0 !important;
        }
        .menu-title > *:not(.menu-title-bg) {
            position: relative;
            z-index: 1;
        }
        .menu-title-text {
            font-weight: bold; font-size: 16pt; 
            color: var(--wvdoh-yellow);
            text-align: center;
            margin-bottom: 4px;
        }
        .menu-title-links {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 6px;
        }
        .menu-title-link {
            color: #4db8ff; /* Bright blue - easily visible */
            text-decoration: underline; /* Always underlined */
            font-size: 10pt;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        .menu-title-link:hover {
            background: rgba(0, 217, 255, 0.2);
            color: #99ebff; /* Slightly darker/more saturated on hover */
        }
        
        /* Radial Menu */
        .radial-menu {
            position: absolute; z-index: 10000; pointer-events: none;
        }
        .radial-center {
            position: absolute; width: 117px; height: 117px; /* 7px larger */
            background: url('wvdot-logo-circle.png') center/cover;
            border: 3px solid white;
            border-radius: 50%; transform: translate(-50%, -50%);
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; pointer-events: auto;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        .center-title { 
            display: none; /* No text, logo is background */
        }
        .center-link {
            display: none; /* Links moved to title */
        }
        
        .radial-option {
            position: absolute; width: 110px; height: 110px;
            background: var(--wvdoh-blue);
            border: 2px solid var(--wvdoh-yellow);
            border-radius: 50%; transform: translate(-50%, -50%);
            display: flex; align-items: center;
            justify-content: center; cursor: pointer; pointer-events: auto;
            transition: all 0.2s;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
        }
        .radial-option:hover {
            background: var(--wvdoh-light-blue);
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 9 !important;
        }
        .radial-option .label {
            font-size: 12pt; font-weight: bold;
            color: var(--wvdoh-yellow);
            text-align: center;
            line-height: 1.1;
            padding: 5px;
            word-wrap: break-word;
            max-width: 95px;
        }
        
        /* Info Panel */
        .info-panel {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 11000; background: var(--box-bg);
            border: 2px solid var(--box-border); border-radius: 12px;
            min-width: 500px; max-width: 700px; max-height: 80vh;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            cursor: default;
        }
        .info-header {
            padding: 18px 20px; border-bottom: 1px solid var(--box-border);
            display: flex; justify-content: space-between; align-items: center;
            background: var(--wvdoh-blue);
            border-radius: 10px 10px 0 0;
            cursor: default;
            user-select: none;
        }
        .info-header h3 { 
            font-size: 14pt; 
            color: var(--wvdoh-yellow);
            text-align: center;
            flex: 1;
        }
        .close-btn {
            background: none; border: none; color: #fff;
            font-size: 28px; cursor: pointer; padding: 0;
            width: 30px; height: 30px; line-height: 1;
        }
        .close-btn:hover { color: var(--wvdoh-yellow); }
        
        .info-content {
            padding: 20px; max-height: 60vh; overflow-y: auto;
        }
        .info-content::-webkit-scrollbar { width: 8px; }
        .info-content::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); }
        .info-content::-webkit-scrollbar-thumb {
            background: var(--wvdoh-yellow); border-radius: 4px;
        }
        
        /* Attributes Panel Scrollbar - Blue and Gold like radial menus */
        .attributes-panel .panel-body::-webkit-scrollbar { width: 8px; }
        .attributes-panel .panel-body::-webkit-scrollbar-track { 
            background: var(--wvdoh-blue); 
        }
        .attributes-panel .panel-body::-webkit-scrollbar-thumb {
            background: #8a7a2a;
            border-radius: 4px;
        }
        .attributes-panel .panel-body::-webkit-scrollbar-thumb:hover {
            background: #a08e30;
        }

        /* HUB Panel Scrollbar */
        .hub-panel .panel-body::-webkit-scrollbar { width: 8px; }
        .hub-panel .panel-body::-webkit-scrollbar-track { background: var(--wvdoh-blue); }
        .hub-panel .panel-body::-webkit-scrollbar-thumb { background: var(--wvdoh-yellow); border-radius: 4px; }
        .hub-panel .panel-body::-webkit-scrollbar-thumb:hover { background: #ffd700; }

        /* Teal slider bars in Attributes panel like screenshot */
        .attributes-panel input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #4a7c8c; /* Teal slider track */
            border-radius: 5px;
            outline: none;
        }
        .attributes-panel input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--wvdoh-yellow);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        .attributes-panel input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--wvdoh-yellow);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        
        .info-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
        }
        .info-item { display: flex; flex-direction: column; }
        .info-item.full-width { grid-column: 1 / -1; }
        .info-label {
            font-size: 10pt; color: rgba(255, 255, 255, 0.7); 
            text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 5px;
        }
        .info-value { font-size: 12pt; font-weight: 600; color: #fff; }
        
        .narrative-section {
            margin-bottom: 20px; padding-bottom: 20px;
            border-bottom: 1px solid var(--box-border);
        }
        .narrative-section:last-child { border-bottom: none; }
        .narrative-section h4 {
            color: var(--wvdoh-yellow); font-size: 12pt; margin-bottom: 10px;
        }
        .narrative-section p {
            color: rgba(255, 255, 255, 0.9); line-height: 1.6; 
            font-size: 11pt; white-space: pre-wrap;
        }
        
        .narrative-updated {
            background: var(--box-bg);
            border: 1px solid var(--box-border);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 10pt;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .condition-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
        }
        .condition-item { text-align: center; }
        .condition-label {
            font-size: 10pt; color: rgba(255, 255, 255, 0.7); 
            margin-bottom: 8px; text-transform: uppercase;
        }
        .condition-rating {
            padding: 12px; border-radius: 8px; font-size: 20pt;
            font-weight: bold; color: #fff;
        }
        
        .loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 2000; text-align: center;
            background: var(--box-bg); padding: 30px 50px;
            border-radius: 8px; border: 1px solid var(--box-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        /* Remove pointer cursor from hidden bridges */
        .leaflet-interactive[fill-opacity="0"],
        .leaflet-interactive[opacity="0"] {
            cursor: default !important;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--wvdoh-yellow); border-radius: 50%;
            animation: spin 1s linear infinite; margin: 0 auto 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Project ring (static) */
        .project-ring {
            stroke-opacity: 0.85;
        }

        /* Project toggle button */
        .project-toggle {
            position: absolute;
            right: 20px;
            z-index: 1000;
            background: var(--wvdoh-blue);
            border: 1px solid var(--wvdoh-yellow);
            color: var(--wvdoh-yellow);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 10pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            width: auto;
            box-sizing: border-box;
            text-align: center;
        }
        .project-toggle:hover {
            opacity: 0.9;
        }
        .project-toggle.active {
            background: var(--wvdoh-yellow);
            border: 1px solid var(--wvdoh-blue);
            color: var(--wvdoh-blue);
        }
        .project-toggle.theme {
            background: #22c55e;
            border: 1px solid var(--wvdoh-blue);
            color: var(--wvdoh-blue);
        }

        /* ===== GUIDED TOUR ===== */
        #tour-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 11999;
            pointer-events: auto;
        }

        #tour-spotlight {
            position: fixed;
            z-index: 12000;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        #tour-spotlight.no-target {
            top: 50% !important;
            left: 50% !important;
            width: 0px !important;
            height: 0px !important;
            border-radius: 50%;
        }

        #tour-tooltip {
            position: fixed;
            z-index: 12001;
            background: var(--wvdoh-blue);
            border: 2px solid var(--wvdoh-yellow);
            border-radius: 8px;
            padding: 16px 20px;
            max-width: 340px;
            color: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: opacity 0.25s ease;
            pointer-events: auto;
        }

        #tour-tooltip h4 {
            color: var(--wvdoh-yellow);
            margin: 0 0 8px 0;
            font-size: 12pt;
        }

        #tour-tooltip p {
            margin: 0 0 12px 0;
            font-size: 10pt;
            line-height: 1.5;
            color: rgba(255,255,255,0.9);
        }

        .tour-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tour-pages {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .tour-page {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8pt;
            font-weight: 600;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .tour-page:hover {
            color: var(--wvdoh-yellow);
            background: rgba(255,184,28,0.15);
        }

        .tour-page-active {
            color: var(--wvdoh-blue);
            background: var(--wvdoh-yellow);
            cursor: default;
        }

        .tour-page-active:hover {
            color: var(--wvdoh-blue);
            background: var(--wvdoh-yellow);
        }

        .tour-btn {
            padding: 6px 14px;
            border-radius: 4px;
            border: 1px solid var(--wvdoh-yellow);
            background: rgba(255,184,28,0.15);
            color: var(--wvdoh-yellow);
            cursor: pointer;
            font-weight: 600;
            font-size: 9pt;
            line-height: 1;
            box-sizing: border-box;
        }

        .tour-btn:hover {
            background: rgba(255,184,28,0.3);
        }

        #tour-help-btn {
            background: transparent;
            border: none;
            color: var(--wvdoh-yellow);
            font-size: 9pt;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
            text-decoration: underline;
            letter-spacing: 0.5px;
        }

        #tour-help-btn:hover {
            color: #fff;
        }

        /* UI Tooltips System */
        .ui-tooltip {
            position: fixed;
            z-index: 15000;
            background: rgba(0, 30, 50, 0.95);
            color: #fff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 9pt;
            line-height: 1.4;
            max-width: 240px;
            pointer-events: none;
            border: 1px solid var(--wvdoh-yellow);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .ui-tooltip.visible { opacity: 1; }
        .ui-tooltip::after {
            content: '';
            position: absolute;
            width: 8px; height: 8px;
            background: rgba(0, 30, 50, 0.95);
            border-right: 1px solid var(--wvdoh-yellow);
            border-bottom: 1px solid var(--wvdoh-yellow);
            transform: rotate(45deg);
            bottom: -5px; left: 50%;
            margin-left: -4px;
        }
        .ui-tooltip.arrow-top::after {
            top: -5px; bottom: auto;
            border-right: none; border-bottom: none;
            border-left: 1px solid var(--wvdoh-yellow);
            border-top: 1px solid var(--wvdoh-yellow);
        }
        .ui-tooltip.arrow-left::after {
            left: -5px; top: 50%; bottom: auto;
            margin-left: 0; margin-top: -4px;
            border-right: none; border-bottom: none;
            border-left: 1px solid var(--wvdoh-yellow);
            border-top: 1px solid var(--wvdoh-yellow);
            transform: rotate(-45deg);
        }
        .ui-tooltip.arrow-right::after {
            right: -5px; left: auto; top: 50%; bottom: auto;
            margin-top: -4px;
            border-left: none; border-top: none;
            border-right: 1px solid var(--wvdoh-yellow);
            border-bottom: 1px solid var(--wvdoh-yellow);
            transform: rotate(-45deg);
        }
        #tooltip-toggle-btn {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.4);
            font-size: 9pt;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
            letter-spacing: 0.5px;
        }
        #tooltip-toggle-btn:hover {
            color: rgba(255,255,255,0.7);
        }
        #tooltip-toggle-btn.active {
            color: var(--wvdoh-yellow);
            text-decoration: underline;
        }

        /* Box Select */
        #box-select-rect {
            position: fixed;
            border: 2px dashed var(--wvdoh-yellow);
            background: rgba(255, 184, 28, 0.1);
            z-index: 10001;
            pointer-events: none;
        }

        #box-select-popup {
            position: fixed;
            z-index: 10002;
            background: var(--wvdoh-blue);
            border: 1px solid var(--wvdoh-yellow);
            border-radius: 8px;
            padding: 12px 16px;
            transform: translateX(-50%);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
            font-size: 9pt;
            color: #fff;
        }

        #box-select-popup button {
            padding: 5px 12px;
            border-radius: 4px;
            border: 1px solid var(--wvdoh-yellow);
            background: rgba(255, 184, 28, 0.15);
            color: var(--wvdoh-yellow);
            cursor: pointer;
            font-weight: 600;
            font-size: 8pt;
        }

        #box-select-popup button:hover {
            background: rgba(255, 184, 28, 0.3);
        }

        #box-filter-indicator {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            background: var(--wvdoh-blue);
            border: 1px solid var(--wvdoh-yellow);
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 9pt;
            color: var(--wvdoh-yellow);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        #box-filter-indicator button {
            padding: 3px 10px;
            border-radius: 4px;
            border: 1px solid var(--wvdoh-yellow);
            background: rgba(255, 184, 28, 0.15);
            color: var(--wvdoh-yellow);
            cursor: pointer;
            font-weight: 600;
            font-size: 8pt;
        }

        #box-filter-indicator button:hover {
            background: rgba(255, 184, 28, 0.3);
        }

        /* Fixed-width category detail table popups */
        #category-table-popup {
            width: 920px;
            max-width: 95vw;
        }
        #category-table-popup .info-header {
            padding: 8px 14px;
        }
        #category-table-popup .info-header h3 {
            font-size: 11pt;
            white-space: nowrap;
        }
        #category-table-popup .info-content table {
            width: 100%;
            table-layout: fixed;
        }
        #category-table-popup .info-content table .col-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 0;
        }

        /* Raise info panels and detail tables above tour overlay so they're usable */
        body.tour-active .info-panel {
            z-index: 12002;
        }

        /* Raise box select elements above the map during tour (map is z-index:12000) */
        body.tour-active #box-select-rect {
            z-index: 12003;
        }
        body.tour-active #box-select-popup {
            z-index: 12004;
        }
        body.tour-active #box-filter-indicator {
            z-index: 12003;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>Loading SpanBase...</div>
    </div>
    
    <div class="last-updated" data-tip="Timestamp of the last data refresh from the bridge inventory">
        Last updated 02/08/26 08:20 PM
    </div>
    
    <div class="header">
        <div class="header-overlay"></div>
        <h1>SpanBase</h1>
        <div class="subtitle">Operations Division – 0066</div>
        <div class="email"><a href="mailto:jason.d.bryan@wv.gov">jason.d.bryan@wv.gov</a></div>
        <div class="search" data-tip="Search bridges by name, BARS number, route, county, or district. Results filter the map in real time.">
            <input type="text" id="searchInput" placeholder="Search...">
        </div>
        <div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 4px; margin-bottom: -12px; margin-right: -20px;">
            <div id="version-label" style="color: #fff; font-size: 9pt; font-style: italic; cursor: default;" data-tip="You're a nosey one, ain't ya?">δ3</div>
        </div>
    </div>
    
    <div id="map"></div>
    
    <div class="evaluation-panel" id="evaluationPanel">
        <div class="folder-tab" onclick="toggleEvaluationPanel()" data-tip="The Condition Filter panel allows you to weight bridge components — Deck, Superstructure, Substructure, Bearings, and Joints. Drag a slider higher to highlight bridges with worse ratings for that component.">
            <div class="folder-tab-text">Condition Filter</div>
        </div>
        <div class="panel-header">
            <h3>Condition Filter</h3>
        </div>
        <div class="panel-body">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 6px;">
                <a href="https://docs.google.com/document/d/1l2MDlr4IAMorvgPfq9pRG9IYsRgGcxOb/edit?usp=sharing&ouid=112943824375355142692&rtpof=true&sd=true" target="_blank" style="color: var(--wvdoh-yellow); font-size: 9pt; font-weight: 600; text-decoration: underline; letter-spacing: 0.5px;" data-tip="Opens the SpanBase User Manual in Google Docs">User Manual</a>
                <span style="color: rgba(255,255,255,0.3);">|</span>
                <button id="tour-help-btn" onclick="startTour()" data-tip="Take an interactive guided tour of SpanBase features">Tutorial</button>
                <span style="color: rgba(255,255,255,0.3);">|</span>
                <button id="tooltip-toggle-btn" onclick="toggleUITooltips()" data-tip="Toggle UI tooltips on or off">Tooltips</button>
            </div>
            <div class="section-switcher">
                <button class="section-btn maintenance active" onclick="switchSection('maintenance')" data-tip="Sliders for Deck, Superstructure, Substructure, Bearings, and Joints. Drag a slider higher to highlight bridges with worse ratings for that component.">Maintenance</button>
                <button class="section-btn inspection" onclick="switchSection('inspection')" data-tip="Filter bridges by inspection type and due month. Check inspection types and months to narrow results.">Inspection</button>
            </div>
            
            <div id="inspectionSection" class="section-content">
                <p class="panel-instructions">
                    Filter bridges by inspection type and due dates.
                </p>
                
                <div class="inspection-types-section">
                    <h4 class="section-title">Inspection Types</h4>
                    <label class="checkbox-label"><input type="checkbox" id="insp-routine" value="Routine"> Routine</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-indepth" value="In-Depth"> In-Depth</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-initial" value="Initial"> Initial</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-nstm" value="NSTM"> NSTM</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-special" value="Special"> Special</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-underwater" value="Underwater"> Underwater</label>
                    <label class="checkbox-label"><input type="checkbox" id="insp-damage" value="Damage"> Damage</label>
                </div>
                
                <div class="inspection-months-section">
                    <h4 class="section-title">Months</h4>
                    <div class="months-grid">
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="1"> Jan</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="2"> Feb</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="3"> Mar</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="4"> Apr</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="5"> May</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="6"> Jun</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="7"> Jul</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="8"> Aug</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="9"> Sep</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="10"> Oct</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="11"> Nov</label>
                        <label class="checkbox-label"><input type="checkbox" class="month-checkbox" value="12"> Dec</label>
                    </div>
                </div>
            </div>
            
            <div id="maintenanceSection" class="section-content active">
                <p class="panel-instructions">
                    Adjust sliders to weight bridge components. Higher values emphasize worse conditions. Missing ratings (N/A) are excluded from calculations.
                </p>
                <div id="eval-sliders-wrapper">
                <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 15px;">
                <div class="slider-group" data-tip="Weight the bridge deck rating (riding surface). Higher = more emphasis on poor decks.">
                <label>Deck</label>
                <div class="slider-container">
                    <input type="range" id="slider-deck" min="0" max="100" step="10" value="0" class="eval-slider">
                    <span class="slider-value" id="value-deck">0%</span>
                </div>
            </div>
            <div class="slider-group" data-tip="Weight the superstructure rating (beams, girders, trusses). Higher = more emphasis on poor superstructures.">
                <label>Superstructure</label>
                <div class="slider-container">
                    <input type="range" id="slider-superstructure" min="0" max="100" step="10" value="0" class="eval-slider">
                    <span class="slider-value" id="value-superstructure">0%</span>
                </div>
            </div>
            <div class="slider-group" data-tip="Weight the substructure rating (piers, abutments, foundations). Higher = more emphasis on poor substructures.">
                <label>Substructure</label>
                <div class="slider-container">
                    <input type="range" id="slider-substructure" min="0" max="100" step="10" value="0" class="eval-slider">
                    <span class="slider-value" id="value-substructure">0%</span>
                </div>
            </div>
            <div class="slider-group" data-tip="Weight the bearing condition. Higher = more emphasis on bridges with poor bearings.">
                <label>Bearings</label>
                <div class="slider-container">
                    <input type="range" id="slider-bearings" min="0" max="100" step="10" value="0" class="eval-slider">
                    <span class="slider-value" id="value-bearings">0%</span>
                </div>
            </div>
            <div class="slider-group" data-tip="Weight the joint condition. Higher = more emphasis on bridges with poor joints.">
                <label>Joints</label>
                <div class="slider-container">
                    <input type="range" id="slider-joints" min="0" max="100" step="10" value="0" class="eval-slider">
                    <span class="slider-value" id="value-joints">0%</span>
                </div>
            </div>
            </div>
            
            <div class="slider-group" style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow);" data-tip="An overall bridge health score from 0 (worst) to 100 (best). The mode button toggles the direction: less than or equal to shows bridges at or below your threshold, greater than or equal to shows bridges at or above it.">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="margin: 0;">Calc. Sufficiency</label>
                    <button id="sufficiency-mode-toggle" onclick="toggleSufficiencyMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                </div>
                <div class="slider-container">
                    <input type="range" id="slider-sufficiency" min="0" max="100" step="5" value="100" class="eval-slider">
                    <span class="slider-value" id="value-sufficiency">100%</span>
                </div>
            </div>
            </div><!-- /eval-sliders-wrapper -->
            </div>

            <!-- Reset Button -->
            <div style="margin-top: 15px; text-align: center;">
                <button onclick="resetCurrentTab()" style="padding: 8px 20px; font-size: 10pt; background: var(--wvdoh-yellow); border: none; border-radius: 4px; cursor: pointer; font-weight: 600; color: var(--wvdoh-blue);" data-tip="Reset all condition sliders to default. You can also press Esc.">Reset</button>
            </div>
            </div>
            
            <!-- WVDOT Logo (outside scrollable area, stays at bottom) -->
            <div style="padding: 15px 10px; text-align: center; flex-shrink: 0;" data-tip="OneDOT — Opens the WVDOT Highways Maintenance page">
                <a href="https://transportation.wv.gov/highways/maintenance/Pages/default.aspx" target="_blank"><img src="wvdot-logo.png" alt="WVDOT Logo" style="width: calc(50% - 20px); max-width: 175px; height: auto; display: block; margin: 0 auto; cursor: pointer;"></a>
            </div>
        </div>
    </div>
    
    <!-- Attributes Filter Panel -->
    <div class="attributes-panel" id="attributesPanel">
        <div class="folder-tab" onclick="toggleAttributesPanel()" data-tip="The Attributes Filter panel allows you to filter bridges by physical attributes — Route, ADT, NHS designation, Age, Length, Width, Area, On/Under bridge type, and structural type code.">
            <div class="folder-tab-text">Attributes Filter</div>
        </div>
        <div class="panel-header">
            <h3>Attributes Filter</h3>
        </div>
        <div class="panel-body">
            <!-- NO INSTRUCTION TEXT -->
            <!-- ROUTE/SUBROUTE SEARCH -->
            <div id="route-search-box" style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Filter bridges by route number (e.g., 79, I-79, US-19) and optional subroute">
                <h4 class="section-title">Route Search</h4>
                <div style="margin-bottom: 10px;">
                    <label class="slider-label" style="margin-bottom: 5px; display: block; font-size: 10pt;">Route</label>
                    <input type="text" id="route-search" placeholder="e.g., 79, I-79, US-19" 
                           style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 10pt;">
                </div>
                <div>
                    <label class="slider-label" style="margin-bottom: 5px; display: block; font-size: 10pt;">Subroute</label>
                    <input type="text" id="subroute-search" placeholder="Optional" 
                           style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 10pt;">
                </div>
            </div>
            
            <!-- ADT SLIDER -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Average Daily Traffic — the number of vehicles crossing per day. The mode button toggles between less than or equal to and greater than or equal to your threshold.">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <h4 class="section-title" style="margin: 0;">ADT</h4>
                    <button id="adt-mode-toggle" onclick="toggleAdtMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                </div>
                <input type="range" class="slider" id="slider-adt" min="0" max="100" value="100" style="width: 100%;">
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="font-size: 9pt; color: rgba(255,255,255,0.6);">0</span>
                    <span class="slider-value" id="value-adt" style="font-size: 9pt;">150,000</span>
                    <span id="max-label-adt" style="font-size: 9pt; color: rgba(255,255,255,0.6);">150,000</span>
                </div>
            </div>
            <!-- NHS FILTER -->
            <div style="background: #003b5c; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Filter by National Highway System designation — federally important routes carry higher funding priority">
                <h4 class="section-title" style="margin-bottom: 6px; text-align: center;">National Highway System</h4>
                <div class="nhs-filter" style="display: flex; gap: 8px; margin: 8px 0; justify-content: center;">
                    <button class="nhs-btn" id="nhs-yes" onclick="setNhsFilter('yes')" style="flex: 0 0 auto; padding: 6px 16px;">Yes</button>
                    <button class="nhs-btn" id="nhs-no" onclick="setNhsFilter('no')" style="flex: 0 0 auto; padding: 6px 16px;">No</button>
                    <button class="nhs-btn active" id="nhs-all" onclick="setNhsFilter('all')" style="flex: 0 0 auto; padding: 6px 16px;">All</button>
                </div>
            </div>
            
            <!-- AGE SLIDER -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Bridge age in years since year built. The mode button toggles between less than or equal to and greater than or equal to your threshold.">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <label style="margin: 0; color: #fff; font-size: 10pt; font-weight: 600;">Bridge Age</label>
                    <button id="age-mode-toggle" onclick="toggleAgeMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                </div>
                <input type="range" class="slider" id="slider-age" min="0" max="100" step="1" value="100" style="width: 100%;">
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">0</span>
                    <span id="value-age" style="color: #fff; font-size: 9pt; font-weight: 600;">210 years</span>
                    <span id="max-label-age" style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">210</span>
                </div>
            </div>
            
            <!-- DIMENSIONS (Length, Width, Area) -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Filter by physical dimensions — Length, Width (out-to-out), and Area. Each slider has a mode toggle for less than or equal to or greater than or equal to. You can use any 2 of the 3 sliders at a time.">
                <h4 class="section-title" style="text-align: center; text-transform: uppercase; color: var(--wvdoh-yellow);">Dimensions</h4>
                <!-- Length slider -->
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label style="margin: 0; color: #fff; font-size: 10pt; font-weight: 600;">Bridge Length</label>
                        <button id="length-mode-toggle" onclick="toggleLengthMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                    </div>
                    <input type="range" class="slider" id="slider-length" min="0" max="100" step="1" value="100" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">0</span>
                        <span id="value-length" style="color: #fff; font-size: 9pt; font-weight: 600;">4,020 ft</span>
                        <span id="max-label-length" style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">4,020</span>
                    </div>
                </div>
                <!-- Width slider -->
                <div style="margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label style="margin: 0; color: #fff; font-size: 10pt; font-weight: 600;">Width (Out-to-Out)</label>
                        <button id="width-mode-toggle" onclick="toggleWidthMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                    </div>
                    <input type="range" class="slider" id="slider-width" min="0" max="100" step="1" value="100" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">0</span>
                        <span id="value-width" style="color: #fff; font-size: 9pt; font-weight: 600;">880 ft</span>
                        <span id="max-label-width" style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">880</span>
                    </div>
                </div>
                <!-- Area slider -->
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label style="margin: 0; color: #fff; font-size: 10pt; font-weight: 600;">Bridge Area</label>
                        <button id="area-mode-toggle" onclick="toggleAreaMode()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;" data-tip="Toggle between less than or equal to and greater than or equal to your threshold">≤ Mode</button>
                    </div>
                    <input type="range" class="slider" id="slider-area" min="0" max="100" step="1" value="100" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">0</span>
                        <span id="value-area" style="color: #fff; font-size: 9pt; font-weight: 600;">403,000 ft<sup>2</sup></span>
                        <span id="max-label-area" style="font-size: 9pt; color: var(--wvdoh-yellow); font-weight: 600;">403,000</span>
                    </div>
                </div>
            </div>

            <!-- ON BRIDGE / UNDER BRIDGE SIDE BY SIDE -->
            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); flex: 1;" data-tip="What travels ON the bridge — uses AND logic: checking multiple narrows to bridges carrying all selected types">
                    <h4 class="section-title">On Bridge</h4>
                    <label class="checkbox-label"><input type="checkbox" class="on-bridge-cb" value="1,4,5"> Highway</label>
                    <label class="checkbox-label"><input type="checkbox" class="on-bridge-cb" value="2,4"> Railroad</label>
                    <label class="checkbox-label"><input type="checkbox" class="on-bridge-cb" value="3,5"> Pedestrian</label>
                    <label class="checkbox-label"><input type="checkbox" class="on-bridge-cb" value="6,7,8"> Interchange</label>
                    <label class="checkbox-label"><input type="checkbox" class="on-bridge-cb" value="0"> Other</label>
                    <label class="checkbox-label"><input type="checkbox" id="attr-utilities"> Utilities</label>
                </div>
                <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); flex: 1;" data-tip="What passes UNDER the bridge — uses AND logic: checking multiple narrows to bridges spanning all selected types">
                    <h4 class="section-title">Under Bridge</h4>
                    <label class="checkbox-label"><input type="checkbox" class="under-bridge-cb" value="5,6,7,8"> Waterway</label>
                    <label class="checkbox-label"><input type="checkbox" class="under-bridge-cb" value="1,4,6,8"> Highway</label>
                    <label class="checkbox-label"><input type="checkbox" class="under-bridge-cb" value="2,4,7,8"> Railroad</label>
                    <label class="checkbox-label"><input type="checkbox" class="under-bridge-cb" value="0,3"> Other</label>
                </div>
            </div>

            <!-- BRIDGE TYPE -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="Filter by structural type code. MULTI mode: check several to combine. SOLO mode: radio-button, one at a time.">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="flex: 1; text-align: left;">
                        <button id="bridge-type-mode-toggle" onclick="toggleBridgeTypeMode()" style="padding: 4px 8px; font-size: 7pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600; white-space: nowrap;">SOLO</button>
                    </div>
                    <h4 class="section-title" style="margin: 0; text-align: center; white-space: nowrap;">Bridge Type</h4>
                    <div style="flex: 1; text-align: right;">
                        <button id="bridge-type-sort-toggle" onclick="toggleBridgeTypeSort()" style="padding: 4px 8px; font-size: 7pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600; white-space: nowrap;">A-Z</button>
                    </div>
                </div>
                <div id="bridge-type-checkboxes" style="max-height: 200px; overflow-y: auto; padding-right: 4px;">
                    <!-- populated dynamically from data -->
                </div>
            </div>
            
            
            <!-- SHOW N/A TOGGLE -->
            <div style="background: #003b5c; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;" data-tip="When checked, shows only bridges that have missing or N/A values for currently active attribute filters">
                <label class="checkbox-label" style="display: flex; align-items: center; justify-content: center;">
                    <input type="checkbox" id="show-na-bridges" style="margin-right: 8px;">
                    <span style="color: #fff; font-weight: 600;">Isolate Missing Data</span>
                </label>
            </div>
            
            <!-- RESET BUTTON -->
            <div style="text-align: center; padding-top: 10px;">
                <button class="reset-btn" onclick="resetAttributesFilter()" style="padding: 10px 24px; background: var(--wvdoh-yellow); color: var(--wvdoh-blue); border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 11pt; transition: all 0.2s;" data-tip="Reset all attribute filters to default. You can also press Esc.">
                    Reset Filters
                </button>
            </div>
        </div>
    </div>
    
    <!-- HUB Filter Panel -->
    <div class="hub-panel" id="hubPanel" style="display: none;">
        <div class="folder-tab" onclick="toggleHubPanel()" data-tip="The HUB Filter panel allows you to view and filter bridge project data from the HUB system — filter by project status, phase, and family code.">
            <div class="folder-tab-text">HUB Filter</div>
        </div>
        <div class="panel-header">
            <h3>HUB Filter</h3>
        </div>
        <div class="panel-body">
            <!-- HUB STATUS -->
            <div style="background: #003b5c; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px; text-align: center;">
                <span id="hub-match-count" style="color: var(--wvdoh-yellow); font-weight: 600; font-size: 10pt;">Loading...</span>
            </div>

            <!-- PROJECT STATUS FILTER -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;">
                <h4 class="section-title" style="text-align: center;">Project Status</h4>
                <div id="hub-status-checkboxes">
                    <!-- populated dynamically -->
                </div>
            </div>

            <!-- PHASE CODE FILTER -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;">
                <h4 class="section-title" style="text-align: center;">Phase</h4>
                <div id="hub-phase-checkboxes">
                    <!-- populated dynamically -->
                </div>
            </div>


            <!-- FAMILY CODE FILTER -->
            <div style="background: #003b5c; padding: 12px; border-radius: 6px; border: 1px solid var(--wvdoh-yellow); margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="flex: 1;"></div>
                    <h4 class="section-title" style="margin: 0; flex: 1; text-align: center;">Family Code</h4>
                    <div style="flex: 1; text-align: right;">
                        <button id="hub-family-sort-toggle" onclick="toggleHubFamilySort()" style="padding: 4px 10px; font-size: 8pt; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--wvdoh-yellow); border-radius: 3px; cursor: pointer; color: var(--wvdoh-yellow); font-weight: 600;">A-Z</button>
                    </div>
                </div>
                <div id="hub-family-checkboxes" style="max-height: 200px; overflow-y: auto; padding-right: 4px;">
                    <!-- populated dynamically -->
                </div>
            </div>

            <!-- RESET BUTTON -->
            <div style="text-align: center; padding-top: 10px;">
                <button class="reset-btn" onclick="resetHubFilter()" style="padding: 10px 24px; background: var(--wvdoh-yellow); color: var(--wvdoh-blue); border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 11pt; transition: all 0.2s;" data-tip="Reset all HUB filters to default. You can also press Esc.">
                    Reset HUB Filter
                </button>
            </div>
        </div>
    </div>

    <button id="projectToggle" class="project-toggle" onclick="toggleProjectRings()" style="display: none;" data-tip="Click to cycle through HUB Data modes: Off, Rings around project bridges, and Full highlight. When Rings or Full highlight is active, a special HUB Data button appears in the radial menu for bridges with project data.">HUB DATA</button>
    <div class="legend" data-tip="Each district has its own color. Click any district name to toggle its bridges on or off. Use the All Off button to hide everything, then selectively enable districts you want to focus on.">
        <h4>Districts</h4>
        <div class="legend-item"><div class="legend-color" style="background: #e63946;"></div> District 1</div>
        <div class="legend-item"><div class="legend-color" style="background: #10B981;"></div> District 2</div>
        <div class="legend-item"><div class="legend-color" style="background: #fcbf49;"></div> District 3</div>
        <div class="legend-item"><div class="legend-color" style="background: #06d6a0;"></div> District 4</div>
        <div class="legend-item"><div class="legend-color" style="background: #118ab2;"></div> District 5</div>
        <div class="legend-item"><div class="legend-color" style="background: #073b4c;"></div> District 6</div>
        <div class="legend-item"><div class="legend-color" style="background: #8338ec;"></div> District 7</div>
        <div class="legend-item"><div class="legend-color" style="background: #ff006e;"></div> District 8</div>
        <div class="legend-item"><div class="legend-color" style="background: #3a86ff;"></div> District 9</div>
        <div class="legend-item"><div class="legend-color" style="background: #F59E0B;"></div> District 10</div>
        
        <div style="text-align: center; margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
            <button id="toggleAllDistricts" onclick="toggleAllDistricts()" style="padding: 6px 12px; font-size: 9pt; background: var(--wvdoh-yellow); border: none; border-radius: 4px; cursor: pointer; font-weight: 600; color: var(--wvdoh-blue);">All Off</button>
        </div>
    </div>
    
    <!-- COUNT REPORT BOX -->
    <div class="count-report" id="countReport" style="display: none;">
        <div style="background: #003b5c; padding: 8px 12px; border-bottom: 2px solid var(--box-border); display: flex; justify-content: space-between; align-items: center; border-radius: 6px 6px 0 0; cursor: default;" id="countReportHeader">
            <h4 style="margin: 0; color: var(--wvdoh-yellow); font-size: 11pt; text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Count Report</h4>
            <button onclick="closeCountReport()" style="background: transparent; color: #fff; border: none; cursor: pointer; font-weight: 700; font-size: 11pt; padding: 0; line-height: 1;">✕</button>
        </div>
        <div id="countReportBody" style="padding: 8px 10px; border-radius: 0 0 6px 6px;">
            <!-- Buttons are built dynamically by buildCountReportButtons() -->
        </div>
    </div>
    
    
    <!-- scale-reference removed (debug artifact) -->
    
    <div class="status-bar" id="statusBar" style="display: none;" data-tip="Shows the current active mode and filter status. Use Reset to return to defaults.">
        <span id="statusText">MODE: Default</span>
        <button id="attributesResetBtn" onclick="resetAttributesFilter()" style="display: none; margin-left: 20px; padding: 6px 16px; background: var(--wvdoh-yellow); color: var(--wvdoh-blue); border: none; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 10pt;">Reset Attributes</button>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
